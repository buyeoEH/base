<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Pico W LED Control</title>
</head>

<body>
    <h1>Control LED</h1>
    <button onclick="sendMessage('ON')">Turn ON</button>
    <button onclick="sendMessage('OFF')">Turn OFF</button>

    <h2>LED Status: <span id="ledStatus">UNKNOWN</span></h2>

    <script src="mqttws31.js"></script>
    <script>
        const clientID = "webclient_" + parseInt(Math.random() * 1000);
        const client = new Paho.MQTT.Client(
            "ad2108ce19ca4229afd02c8277f04889.s1.eu.hivemq.cloud",
            8884,
            clientID
        );

        // ì—°ê²° ì™„ë£Œ í›„ í˜¸ì¶œë  í•¨ìˆ˜
        function onConnect() {
            console.log("âœ… Connected to MQTT broker");
            client.subscribe("status/led");  // ìƒíƒœ í† í”½ êµ¬ë…
        }

        // ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ ì‹¤í–‰ë  í•¨ìˆ˜
        client.onMessageArrived = function (message) {
            console.log("ğŸ“© Message arrived: " + message.payloadString);
            const statusElement = document.getElementById("ledStatus");
            statusElement.textContent = message.payloadString;
        };

        // ì—°ê²° ì‹œì‘
        client.connect({
            onSuccess: onConnect,
            userName: "buyeo",
            password: "Buyeo1974@",
            useSSL: true
        });

        // ë©”ì‹œì§€ ë³´ë‚´ê¸° í•¨ìˆ˜
        function sendMessage(msg) {
            const message = new Paho.MQTT.Message(msg);
            message.destinationName = "temp";  // LED ì œì–´ìš© topic
            client.send(message);
        }
    </script>
</body>

</html>
